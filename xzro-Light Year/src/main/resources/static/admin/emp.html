<!DOCTYPE html>
<html lang="zh">
<head>
  <base href="/"/>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>员工管理</title>
  <link rel="icon" href="favicon.ico" type="image/ico">
  <meta name="keywords" content="LightYear,光年,后台模板,后台管理系统,光年HTML模板">
  <meta name="description" content="LightYear是一个基于Bootstrap v3.3.7的后台管理系统的HTML模板。">
  <meta name="author" content="yinqi">
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/materialdesignicons.min.css" rel="stylesheet">
  <link href="css/style.min.css" rel="stylesheet">
  <link rel="stylesheet" href="js/jconfirm/jquery-confirm.min.css">
  <!--时间选择插件-->
  <link rel="stylesheet" href="js/bootstrap-datetimepicker/bootstrap-datetimepicker.min.css">
  <!--日期选择插件-->
  <link rel="stylesheet" href="js/bootstrap-datepicker/bootstrap-datepicker3.min.css">
  <link href="css/style.min.css" rel="stylesheet">
</head>

<body data-theme="dark">
<div class="lyear-layout-web">
  <div class="lyear-layout-container">
    <!--左侧导航-->
    <aside class="lyear-layout-sidebar">

      <!-- logo -->
      <div id="logo" class="sidebar-header">
        <a href="index.html"><img src="images/logo-sidebar.png" title="LightYear" alt="LightYear" /></a>
      </div>
      <div class="lyear-layout-sidebar-scroll">

        <nav class="sidebar-main">
          <ul class="nav nav-drawer">
            <li class="nav-item"> <a href="admin/index.html"><i class="mdi mdi-home"></i> 后台首页</a> </li>
            <li class="nav-item nav-item-has-subnav open">
              <a href="javascript:void(0)"><i class="mdi mdi-palette"></i>企业管理</a>
                <ul class="nav nav-subnav ">
                  <li class="active"> <a href="admin/emp.html">员工管理</a> </li>
                  <li> <a href="admin/dept.html">部门管理</a> </li>
              </ul>
              </li>
              </ul>
            </li>
          </ul>
        </nav>

        <div class="sidebar-footer">
          <p class="copyright">Copyright &copy; 2019. <a target="_blank" href="http://lyear.itshubao.com">IT书包</a> All rights reserved.</p>
        </div>
      </div>

    </aside>
    <!--End 左侧导航-->

    <!--头部信息-->
    <header class="lyear-layout-header">

      <nav class="navbar navbar-default">
        <div class="topbar">

          <div class="topbar-left">
            <div class="lyear-aside-toggler">
              <span class="lyear-toggler-bar"></span>
              <span class="lyear-toggler-bar"></span>
              <span class="lyear-toggler-bar"></span>
            </div>
            <span class="navbar-page-title"> 企业管理 - 员工管理 </span>
          </div>

          <ul class="topbar-right">
            <li class="dropdown dropdown-profile">
              <a href="javascript:void(0)" data-toggle="dropdown">
                <img class="img-avatar img-avatar-48 m-r-10" src="images/users/avatar.jpg" alt="笔下光年" />
                <span><span id="username">笔下光年</span> <span class="caret"></span></span>
              </a>
              <ul class="dropdown-menu dropdown-menu-right">
                <li> <a href="lyear_pages_profile.html"><i class="mdi mdi-account"></i> 个人信息</a> </li>
                <li> <a href="lyear_pages_edit_pwd.html"><i class="mdi mdi-lock-outline"></i> 修改密码</a> </li>
                <li> <a href="javascript:void(0)"><i class="mdi mdi-delete"></i> 清空缓存</a></li>
                <li class="divider"></li>
                <li> <a href="javascript:void(0);" id="logoutLink"><i class="mdi mdi-logout-variant"></i> 退出登录</a> </li>
              </ul>
            </li>
          </ul>

        </div>
      </nav>

    </header>
    <!--End 头部信息-->

    <!--页面主要内容-->
    <main class="lyear-layout-content">

      <div class="container-fluid">
        <div class="col-md-12">
          <div class="card">
            <div class="card-toolbar clearfix">
              <div class="toolbar-btn-action">
                <a class="btn btn-primary m-r-5" href="javascript:void(0);" onclick="showAddModel()"><i class="mdi mdi-plus"></i> 新增</a>
              </div>
            </div>
            <div id="all_employee_table" class="card-body">

            </div>
          </div>
        </div>

      </div>

    </main>
    <!--End 页面主要内容-->
  </div>
</div>
<!--新增模态框-->
<div class="modal fade" id="addModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">新增员工</h4>
      </div>
      <div class="modal-body">
        <form id="addForm" class="form-horizontal">
          <div class="form-group">
            <label for="inputEmail3" class="col-sm-2 control-label">员工姓名</label>
            <div class="col-sm-10">
              <input type="text" class="form-control" id="inputEmail3" name="ename" placeholder="请输入员工姓名">
            </div>
          </div>
          <div class="form-group">
            <label for="inputPassword3" class="col-sm-2 control-label" >员工年龄</label>
            <div class="col-sm-10">
              <input type="text" class="form-control" id="inputPassword3" name="eage" placeholder="请输入员工年龄">
            </div>
          </div>
          <div class="form-group">
            <label for="inputPassword3" class="col-sm-2 control-label" >员工工号</label>
            <div class="col-sm-10">
              <input type="text" class="form-control" name="eno" placeholder="请输入员工工号">
            </div>
          </div>

          <div class="form-group">
            <label for="inputPassword3" class="col-sm-2 control-label" >员工工种</label>
            <div class="col-sm-10">
              <input type="text" class="form-control" name="ejob" placeholder="请输入员工工种">
            </div>
          </div>
          <div class="form-group">
            <label for="inputPassword3" class="col-sm-2 control-label" >员工薪资</label>
            <div class="col-sm-10">
              <input type="text" class="form-control" name="esalary" placeholder="请输入员工薪资">
            </div>
          </div>
          <div class="form-group">
            <label for="inputPassword3" class="col-sm-2 control-label" >员工性别</label>
            <div class="col-xs-3">
              <label class="radio-inline" for="example-inline-radio3">
                <input type="radio" id="example-inline-radio3" name="egender" value="男">
                男
              </label>
              <label class="radio-inline" for="example-inline-radio4">
                <input type="radio" id="example-inline-radio4" name="egender" value="女">
                女
              </label>
            </div>
          </div>
          <div class="form-group">
            <label for="inputPassword3" class="col-sm-2 control-label" >员工状态</label>
            <div class="col-xs-3">
              <label class="radio-inline" for="example-inline-radio1">
                <input type="radio" id="example-inline-radio1" name="estate" value="1">
                在职
              </label>
              <label class="radio-inline" for="example-inline-radio2">
                <input type="radio" id="example-inline-radio2" name="estate" value="0">
                离职
              </label>
            </div>
          </div>
          <div class="form-group">
            <label for="inputPassword3" class="col-sm-2 control-label" >入职日期</label>
            <div class="col-sm-10">
              <input class="form-control js-datetimepicker" type="text" id="example-datetimepicker" name="eentrydate" placeholder="请选择具体时间" value="" data-side-by-side="true" data-locale="zh-cn" data-format="YYYY-MM-DD HH:mm:ss" />
            </div>
          </div>
          <div class="form-group">
            <label for="inputPassword3" class="col-sm-2 control-label" >所在部门</label>
            <div class="col-xs-10">
              <select class="form-control" name="did" size="1">
              </select>
            </div>
          </div>
        </form>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
        <button type="button" class="btn btn-primary" onclick="addEmployee()">保存</button>
      </div>
    </div>
  </div>
</div>
<!--新增模态框-->
<!--修改模态框-->
<div class="modal fade" id="updateModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel1">修改员工</h4>
      </div>
      <div class="modal-body">
        <form id="updateForm" class="form-horizontal">
          <input type="hidden" class="form-control" id="inputEmail6" name="eid" placeholder="请输入员工姓名">
          <div class="form-group">
            <label for="inputEmail3" class="col-sm-2 control-label">员工姓名</label>
            <div class="col-sm-10">
              <input type="text" class="form-control" id="inputEmail5" name="ename" placeholder="请输入员工姓名">
            </div>
          </div>
          <div class="form-group">
            <label for="inputPassword3" class="col-sm-2 control-label" >员工年龄</label>
            <div class="col-sm-10">
              <input type="text" class="form-control" id="inputPassword6" name="eage" placeholder="请输入员工年龄">
            </div>
          </div>
          <div class="form-group">
            <label for="inputPassword3" class="col-sm-2 control-label" >员工工号</label>
            <div class="col-sm-10">
              <input type="text" class="form-control" name="eno" placeholder="请输入员工工号">
            </div>
          </div>

          <div class="form-group">
            <label for="inputPassword3" class="col-sm-2 control-label" >员工工种</label>
            <div class="col-sm-10">
              <input type="text" class="form-control" name="ejob" placeholder="请输入员工工种">
            </div>
          </div>
          <div class="form-group">
            <label for="inputPassword3" class="col-sm-2 control-label" >员工薪资</label>
            <div class="col-sm-10">
              <input type="text" class="form-control" name="esalary" placeholder="请输入员工薪资">
            </div>
          </div>
          <div class="form-group">
            <label for="inputPassword3" class="col-sm-2 control-label" >员工性别</label>
            <div class="col-xs-3">
              <label class="radio-inline" for="example-inline-radio7">
                <input type="radio" id="example-inline-radio7" name="egender" value="男">
                男
              </label>
              <label class="radio-inline" for="example-inline-radio8">
                <input type="radio" id="example-inline-radio8" name="egender" value="女">
                女
              </label>
            </div>
          </div>
          <div class="form-group">
            <label for="inputPassword3" class="col-sm-2 control-label" >员工状态</label>
            <div class="col-xs-3">
              <label class="radio-inline" for="example-inline-radio9">
                <input type="radio" id="example-inline-radio9" name="estate" value="1">
                在职
              </label>
              <label class="radio-inline" for="example-inline-radio10">
                <input type="radio" id="example-inline-radio10" name="estate" value="0">
                离职
              </label>
            </div>
          </div>
          <div class="form-group">
            <label for="inputPassword3" class="col-sm-2 control-label" >入职日期</label>
            <div class="col-sm-10">
              <input class="form-control js-datetimepicker" type="text" name="eentrydate" placeholder="请选择具体时间" value="" data-side-by-side="true" data-locale="zh-cn" data-format="YYYY-MM-DD HH:mm:ss" />
            </div>
          </div>
          <div class="form-group">
            <label for="inputPassword3" class="col-sm-2 control-label" >所在部门</label>
            <div class="col-xs-10">
              <select class="form-control" name="did" size="1">
              </select>
            </div>
          </div>
        </form>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
        <button type="button" class="btn btn-primary" onclick="updateEmployee()">保存</button>
      </div>
    </div>
  </div>
</div>
<!--修改模态框-->
<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/perfect-scrollbar.min.js"></script>
<script type="text/javascript" src="js/main.min.js"></script>

<script type="text/javascript" src="js/template-web.js"></script>
<!--消息提示-->
<script src="js/bootstrap-notify.min.js"></script>
<script type="text/javascript" src="js/lightyear.js"></script>
<script type="text/javascript" src="js/template-web.js"></script>
<!--分页显示员工的模板-->
<script type="text/html" id="all_employee">
  <table class="table table-bordered table-hover">
    <thead>
    <tr>
      <th class="text-center">ID</th>
      <th class="text-center">工号</th>
      <th class="text-center">姓名</th>
      <th class="text-center">年龄</th>
      <th class="text-center">性别</th>
      <th class="text-center">工种</th>
      <th class="text-center">入职时间</th>
      <th class="text-center">薪资</th>
      <th class="text-center">在职状态</th>
      <th class="text-center">部门名称</th>
      <th class="text-center" colspan="2">操作</th>
    </tr>
    </thead>
    <tbody>
    {{each data.list}}
    <tr>
      <th scope="row">{{$value.eid}}</th>
      <td>{{$value.eno}}</td>
      <td>{{$value.ename}}</td>
      <td>{{$value.eage}}</td>
      <td>{{$value.egender}}</td>
      <td>{{$value.ejob}}</td>
      <td>{{$value.eentrydate}}</td>
      <td>{{$value.esalary}}</td>
      {{if $value.estate==1}}
        <td><span class="label label-success">在职</span></td>
      {{else}}
        <td><span class="label label-danger">离职</span></td>
      {{/if}}
      <td>{{$value.department.dname}}</td>
      <td class="text-center">
        <button type="button" class="btn  btn-info btn-xs" onclick="showUpdateModel(`{{$value.eid}}`,`{{data.pageNum}}`)">
          <i class="mdi mdi-pencil"></i>
          修改
        </button>
      </td>
      <td class="text-center">
        <button type="button" class="btn  btn-danger btn-xs" onclick="delEmployee(`{{$value.eid}}`,`{{data.pageNum}}`)">
          <i class="mdi mdi-close"></i>
          删除
        </button>
      </td>
    </tr>
    {{/each}}
    </tbody>
  </table>
  <nav class="text-center">
    <ul class="pagination">
      {{if data.isFirstPage == true}}
      <li class="disabled">
        <a href="javascript:void(0);">
          <span><i class="mdi mdi-chevron-left"></i></span>
        </a>
      </li>
      {{else}}
      <li>
        <a href="javascript:void(0);" onclick="selectByPage(`{{data.pageNum-1}}`)">
          <span><i class="mdi mdi-chevron-left"></i></span>
        </a>
      </li>
      {{/if}}
      {{each data.navigatepageNums}}
      {{if data.pageNum == $value}}
          <li class="active"><a href="javascript:void (0);" >{{$value}}</a></li>
      {{else}}
          <li><a href="javascript:void (0);" onclick="selectByPage(`{{$value}}`)">{{$value}}</a></li>
      {{/if}}
      {{/each}}
      {{if data.isLastPage == true}}
      <li class="disabled">
        <a href="javascript:void(0);">
          <span><i class="mdi mdi-chevron-right"></i></span>
        </a>
      </li>
      {{else}}
      <li>
        <a href="javascript:void(0);" onclick="selectByPage(`{{data.pageNum+1}}`)">
          <span><i class="mdi mdi-chevron-right"></i></span>
        </a>
      </li>
      {{/if}}
    </ul>
  </nav>
</script>
<!--分页显示员工的模板-->
<!--显示所有部门下拉列表的模板-->
<script type="text/html" id="all_department_option">
  {{each data}}
    <option value="{{$value.did}}">{{$value.dname}}</option>
  {{/each}}
</script>
<!--显示所有部门下拉列表的模板-->

<script type="text/javascript">
  $.ajax({
    url: "admin/info/userinfo",
    type: "POST",
    dataType: "JSON",
    success:function (resp) {
      $("#username").text(resp.data.username)
    }
  })
// 退出登录开始
  $("#logoutLink").click(function(){
    lightyear.loading('show');
    $.ajax({
      url:"adminController/logout",
      type:"GET",
      dataType: "JSON",
      success:function (response) {
        lightyear.loading('hide');  // 隐藏
        if (response.code == 10000) {
          //退出成功
          lightyear.notify('退出成功，页面即将自动跳转~', 'success', 2000, 'mdi mdi-emoticon-happy', 'top', 'center' , 'admin/login.html');
        }else{
          //退出失败
          lightyear.notify("退出失败", 'danger', 2000, 'mdi mdi-emoticon-sad', 'top', 'center' );
        }
      }
    })
  })
// 退出登录结束
//添加员工方法开始
function addEmployee() {
  lightyear.loading('show');
  var fields = $("#addForm").serializeArray();
  var obj = {}; //声明一个对象
  $.each(fields, function(index, field) {
    obj[field.name] = field.value; //通过变量，将属性值，属性一起放到对象中
  })
  obj['eid'] = null;
  $.ajax({
    url:"admin/employee/insert",
    type:"POST",
    contentType: "application/json",
    data:JSON.stringify(obj),
    dataType: "JSON",
    success: function (resp) {
      lightyear.loading('hide');
      if (resp.code == 10000) {
        //添加成功
        lightyear.notify('添加成功', 'success', 2000, 'mdi mdi-emoticon-happy', 'top', 'center');
        $("#addForm")[0].reset();
        $("#addModal").modal("hide");
        // selectByPage(1);
        //跳转到最后一页
        $. ajax({
          url: "admin/employee/selectByPage",
          type: "GET",
          data: {currentPage:1},
          dataType: "JSON",
          success: function (resp) {
            console.log(resp.data.navigateLastPage)
            selectByPage(resp.data.navigateLastPage);
          }
        })

      }else{

        //添加失败
        lightyear.notify("添加失败", 'danger', 2000, 'mdi mdi-emoticon-sad', 'top', 'center' );
      }
    }
  })
}
//添加员工方法结束
var freshPage = 1;
//修改员工方法开始
  function updateEmployee() {
    var fields = $("#updateForm").serializeArray();
    var obj = {}; //声明一个对象
    $.each(fields, function(index, field) {
      obj[field.name] = field.value; //通过变量，将属性值，属性一起放到对象中
    })
    lightyear.loading('show');
    $.ajax({
      url:"admin/employee/update",
      type:"POST",
      contentType:"application/json",
      data:JSON.stringify(obj),
      dataType: "JSON",
      success: function (resp) {
        lightyear.loading('hide');
        if (resp.code == 10000) {
          //添加成功
          lightyear.notify('修改成功', 'success', 2000, 'mdi mdi-emoticon-happy', 'top', 'center');
          $("#updateForm")[0].reset();
          $("#updateModal").modal("hide");
          //刷新当前页面
          selectByPage(freshPage);
        }else{
          //修改失败
          lightyear.notify(resp.msg, 'danger', 2000, 'mdi mdi-emoticon-sad', 'top', 'center' );
        }
      }
    })
  }
//修改员工方法结束
//显示添加的模态框开始
  function showAddModel(eid){
    //发送Ajax请求 查询所有部门
    $. ajax({
      url: "admin/department/selectAll",
      type: "GET",
      dataType: "JSON",
      success: function (resp) {
        //将resp.data返回的数据挂载到页面上
        let html = template('all_department_option', {data: resp.data});
        $("#addModal [name='did']").html(html);
        $("#addModal").modal("show");
      }
    })
  }
//显示添加的模态框结束

//显示修改的模态框开始
  function showUpdateModel(eid,currentPage) {
    //发送Ajax请求 查询所有部门
    $. ajax({
      url: "admin/department/selectAll",
      type: "GET",
      dataType: "JSON",
      success: function (resp) {
        //将resp.data返回的数据挂载到页面上
        let html = template('all_department_option', {data: resp.data});
        //获取修改数据
        $.ajax({
          url:"admin/employee/selectByEid",
          type: "GET",
          data:{eid: eid},
          dataType: "JSON",
          success: function (resp) {
            $("#updateForm input[name='eid']").val(resp.data.eid)
            $("#updateForm input[name='ename']").val(resp.data.ename)
            $("#updateForm input[name='eage']").val(resp.data.eage)
            $("#updateForm input[name='eno']").val(resp.data.eno)
            $("#updateForm input[name='ejob']").val(resp.data.ejob)
            $("#updateForm input[name='esalary']").val(resp.data.esalary)
            $("#updateForm input[name='estate'][value='" + resp.data.estate + "']").prop("checked", true);
            $("#updateForm input[name='egender'][value='" + resp.data.egender + "']").prop("checked", true);
            $("#updateForm input[name='eentrydate']").val(resp.data.eentrydate)
            $("#updateForm input[name='did']").val(resp.data.did)
            freshPage = currentPage;
          }
        })
        $("#updateModal").modal("show");
        $("#updateModal [name='did']").html(html);
      }
    })


  }
//显示修改的模态框结束

  //查询分页开始
  function selectByPage(currentPage) {
    $. ajax({
      url: "admin/employee/selectByPage",
      type: "GET",
      data: {currentPage:currentPage},
      dataType: "JSON",
      success: function (resp) {
        let html = template('all_employee', {data: resp.data});
        $("#all_employee_table").html(html);
      }
    })
  }
//查询分页结束
//删除开始
function delEmployee(eid,currentPage) {
    $.alert({
      title: '删除',
      content: '你确认要删除该员工么？',
      buttons: {
        confirm: {
          text: '确认',
          btnClass: 'btn-primary',
          action: function(){
            lightyear.loading('show');
            //发送ajax请求
            $.ajax({
              url:"admin/employee/delete",
              type:"POST",
              data: {eid:eid},
              dataType: 'JSON',
              success: function (response) {
                lightyear.loading('hide');  // 隐藏
                if (response.code == 10000) {
                  //刷新当前页面
                  selectByPage(currentPage);
                  lightyear.notify('删除成功', 'success', 2000, 'mdi mdi-emoticon-happy', 'top', 'center');
                }else{
                  //退出失败
                  lightyear.notify("删除失败", 'danger', 2000, 'mdi mdi-emoticon-sad', 'top', 'center' );
                }
              },
            })
          }
        },
        cancel: {
          text: '取消'
        }
      }
    });
  }
//删除结束

selectByPage(1);
</script>
<!--对话框-->
<script src="js/jconfirm/jquery-confirm.min.js"></script>
<!--时间选择插件-->
<script src="js/bootstrap-datetimepicker/moment.min.js"></script>
<script src="js/bootstrap-datetimepicker/bootstrap-datetimepicker.min.js"></script>
<script src="js/bootstrap-datetimepicker/locale/zh-cn.js"></script>
</body>
</html>